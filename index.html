<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyEase</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: #0F172A;
    color: #E5E7EB;
  }

  /* HEADER */
  header {
    background: #1E293B;
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header h1 {
    margin: 0;
    color: #3B82F6;
  }

  .account {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .account button {
    padding: 8px 14px;
  }

  /* MAIN */
  main {
    padding: 20px;
    display: grid;
    gap: 20px;
    max-width: 900px;
    margin: auto;
  }

  .card {
    background: #1E293B;
    padding: 20px;
    border-radius: 12px;
  }

  .grid {
    display: grid;
    gap: 20px;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  button {
    background: #3B82F6;
    border: none;
    padding: 10px 16px;
    color: white;
    border-radius: 8px;
    cursor: pointer;
  }

  button:hover {
    opacity: 0.9;
  }

  .highlight {
    font-size: 2rem;
    color: #22C55E;
    font-weight: bold;
  }

  ul {
    padding-left: 18px;
  }

  footer {
    text-align: center;
    padding: 15px;
    color: #94A3B8;
  }
</style>
</head>

<body>

<header>
  <h1>StudyEase</h1>

  <!-- ACCOUNT (RIGHT SIDE) -->
  <div class="account">
    <span id="welcomeMsg"></span>
    <button id="signInBtn" onclick="location.href='auth.html'">Sign In</button>
    <button id="signUpBtn" onclick="location.href='auth.html'">Sign Up</button>
    <button id="logoutBtn" onclick="logout()" style="display:none;">Log Out</button>
  </div>
</header>

<main>

  <!-- QUICK ACTIONS -->
  <section class="card">
    <h2>âš¡ Quick Actions</h2>
    <button onclick="location.href='timer.html'">â± Study Timer</button>
    <button onclick="location.href='add_goal.html'">â• Add Goal</button>
    <button onclick="location.href='add_exam.html'">ğŸ—“ Add Exam</button>
    <button onclick="location.href='exam_timetable.html'">ğŸ“… View Exam Timetable</button>
    <button onclick="location.href='goals.html'">ğŸ¯ View Goals</button>
  </section>

  <!-- DASHBOARD GRID -->
  <section class="grid">

    <div class="card">
      <h3>ğŸ“Œ Goals Remaining</h3>
      <p>Today: <strong id="todayGoals">3</strong></p>
      <p>This Week: <strong id="weekGoals">10</strong></p>
    </div>

    <div class="card">
      <h3>ğŸ“… Exam Countdown</h3>
      <h4 id="nextExam">Loading...</h4>
      <p class="highlight"><span id="daysLeft"></span> days left</p>
    </div>

    <div class="card">
      <h3>â­ XP Level</h3>
      <p class="highlight"><span id="xp">120</span> XP</p>
      <p>Level up by staying consistent!</p>
    </div>

    <div class="card">
      <h3>ğŸ‘£ How to Increase XP</h3>
      <ul>
        <li>Complete daily goals</li>
        <li>Finish study timer sessions</li>
        <li>Maintain streaks</li>
        <li>Weekly revision</li>
      </ul>
    </div>

  </section>

</main>

<footer>
  Made for students â€¢ No pressure ğŸŒ±
</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBMEmLkJ8_-A1iSD_IF2NccOJHdcRm_Lug",
    authDomain: "study-2f23d.firebaseapp.com",
    projectId: "study-2f23d",
    storageBucket: "study-2f23d.firebasestorage.app",
    messagingSenderId: "213003244292",
    appId: "1:213003244292:web:ef994cb72bc3d265037651"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const signInBtn = document.getElementById("signInBtn");
  const signUpBtn = document.getElementById("signUpBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const welcomeMsg = document.getElementById("welcomeMsg");

  auth.onAuthStateChanged(async user => {
    if (user) {
      signInBtn.style.display = "none";
      signUpBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      welcomeMsg.innerText = `Hi, ${user.displayName || user.email}`;
      let xp = await firebase.firestore()
        .collection("users")
        .doc(user.email)
        .get()
        .then(doc => doc.exists ? doc.data().xp || 0 : 0);
        document.getElementById("xp").innerText = xp;
        
      getUpcomingExam().then(result => {
  if (!result) {
    document.getElementById("nextExam").innerText = "No upcoming exams ğŸ‰";
  document.getElementById("daysLeft").innerText = "--";
  return;
  }
    const [examName, examDate, daysLeft] = result;
    document.getElementById("nextExam").innerText = examName + " on " + examDate.toDateString();
    document.getElementById("daysLeft").innerText = daysLeft;
    });
    } else {
      signInBtn.style.display = "inline-block";
      signUpBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      welcomeMsg.innerText = "";
    }
  });

  function logout() {
    auth.signOut().then(() => {
      alert("Logged out");
    });
  }
  


  function getUpcomingExam() {
  return new Promise((resolve, reject) => {
    const user = firebase.auth().currentUser;
    if (!user) {
      resolve(null);
      return;
    }

    const now = new Date();

    firebase.firestore()
      .collection("users")
      .doc(user.email)
      .collection("exams")
      .orderBy("examDateTime")
      .get()
      .then(snapshot => {
        for (const doc of snapshot.docs) {
          const data = doc.data();
          const examDate = data.examDateTime.toDate();

          if (examDate >= now) {
            const daysLeft = Math.ceil(
              (examDate - now) / (1000 * 60 * 60 * 24)
            );

            resolve([
              data.subject,     // exam name
              examDate,         // exam date (Date object)
              daysLeft          // days left
            ]);
            return;
          }
        }

        resolve(null); // No upcoming exams
      })
      .catch(error => reject(error));
  });
}

</script>

</body>
</html>
