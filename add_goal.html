<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Goal</title>

<style>
  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #6366f1, #4f46e5);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card {
    background: #fff;
    width: 420px;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  }

  h2 {
    margin-top: 0;
    text-align: center;
    color: #4f46e5;
  }

  label {
    font-size: 14px;
    font-weight: 600;
    color: #374151;
  }

  input, select {
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    margin-bottom: 14px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    font-size: 14px;
  }

  input:focus, select:focus {
    outline: none;
    border-color: #4f46e5;
  }

  .days {
    display: none;
    margin-bottom: 10px;
  }

  .days label {
    display: inline-block;
    margin: 6px 8px 6px 0;
    font-weight: normal;
  }

  .xp {
    text-align: center;
    background: #eef2ff;
    padding: 10px;
    border-radius: 10px;
    font-size: 14px;
    color: #4338ca;
    margin-bottom: 15px;
  }

  button {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 12px;
    background: #4f46e5;
    color: #fff;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
  }

  button:hover {
    background: #4338ca;
  }
</style>
</head>

<body>

<button id = "backBtn" onclick="window.location.href='index.html'" style="position: absolute; top: 20px; left: 20px; background: #334155; color: white; border-radius: 8px; padding: 10px 16px; border: none; cursor: pointer;">‚Üê Back to Home</button>

<div class="card">
  <h2>üéØ Add New Goal</h2>

  <label>Goal Title</label>
  <input id="title" placeholder="Eg: Study Maths for 1 hour">

  <label>Goal Type</label>
  <select id="type">
    <option value="daily">Daily</option>
    <option value="weekly">Weekly</option>
    <option value="custom">Specific Days</option>
  </select>

  <div class="days" id="daysBox">
    <label><input type="checkbox" value="Mon"> Mon</label>
    <label><input type="checkbox" value="Tue"> Tue</label>
    <label><input type="checkbox" value="Wed"> Wed</label>
    <label><input type="checkbox" value="Thu"> Thu</label>
    <label><input type="checkbox" value="Fri"> Fri</label>
    <label><input type="checkbox" value="Sat"> Sat</label>
    <label><input type="checkbox" value="Sun"> Sun</label>
  </div>

  <div class="xp">‚≠ê Completing this goal gives <b>10 XP</b></div>

  <button onclick="addGoal()">Add Goal</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // Firebase Config
  const firebaseConfig = {
  apiKey: "AIzaSyBMEmLkJ8_-A1iSD_IF2NccOJHdcRm_Lug",
  authDomain: "study-2f23d.firebaseapp.com",
  projectId: "study-2f23d",
  storageBucket: "study-2f23d.firebasestorage.app",
  messagingSenderId: "213003244292",
  appId: "1:213003244292:web:ef994cb72bc3d265037651",
  measurementId: "G-WNCK3CT1V2"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const type = document.getElementById("type");
  const daysBox = document.getElementById("daysBox");

  type.addEventListener("change", () => {
    daysBox.style.display = type.value === "daily" ? "none" : "block";
  });

  window.addGoal = async () => {
    const user = auth.currentUser;
    if (!user) return alert("Please login first");

    const title = document.getElementById("title").value.trim();
    if (!title) return alert("Enter goal title");

    let days = [];
    if (type.value !== "daily") {
      days = [...daysBox.querySelectorAll("input:checked")]
        .map(d => d.value);
      if (days.length === 0)
        return alert("Select at least one day");
    }

    await addDoc(
      collection(db, "users", user.email, "goals"),
      {
        title,
        type: type.value,
        days,
        xp: 10,
        completed: false,
        createdAt: serverTimestamp()
      }
    );

    alert("Goal added successfully üéâ");
    document.getElementById("title").value = "";
  };
  const dayCheckboxes = daysBox.querySelectorAll("input[type='checkbox']");

    dayCheckboxes.forEach(cb => {
    cb.addEventListener("change", () => {
        // If weekly ‚Üí allow only ONE day
        if (type.value === "weekly") {
        dayCheckboxes.forEach(other => {
            if (other !== cb) other.checked = false;
        });
        }
    });
    });
</script>

</body>
</html>
